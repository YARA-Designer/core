<link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">

<div class="block1">
    <h1> Case: {{ case.data.title }} [ID: {{ case.data.id }}] </h1>
    <h2>Severity: {{ case.data.severity }}</h2>
    <h4>Tags: {{ case.data.tags }}</h4>
    {% if case.data.customFields %}
        <h5>Custom fields: {{ case.data.customFields }}</h5>
    {% endif %}

    <form action="{{ url_for('post_rule') }}" method="post">
        <table>
            <tr>
                <th>Variable ref.</th>
                <th>Artifact</th>
                <th>Type</th>
                <th>ID</th>
            </tr>
                {% for key, value in case.data.items() %}
                    {% if key == "observables" %}
                            <td>

                                {% for observable in case.data.observables %}
                                    <tr>
                                      <td>
                                          <p class="artifact_varname" id="artifact_{{ loop.index }}">
                                              $artifact{{ loop.index }}
                                          </p>
                                      </td>
                                      <td>
                                          <p id="artifact">
                                              {{ observable.data }}
                                          </p>
                                      </td>
                                      <td>
                                          <p id="artifactType">
                                              {{ observable.dataType }}
                                          </p>
                                      </td>
                                      <td>
                                          <p id="artifactId">
                                              {{ observable.id }}
                                          </p>
                                      </td>
                                    </tr>
                                {% endfor %}
                            </td>
                    {% endif %}
                {% endfor %}
        </table>
        <label for="raw_yara_condition"></label><input type="text" id="raw_yara_condition" value="" style="width:93%;display:inline-block;float:left">
        <input type="submit" value="Submit (RAW)">
    </form>
</div>

<!-- DETAILS SECTION //-->
<button type="button" class="caseDetailsCollapsible">Show case details</button>
<div class="caseDetailsContent">
    <table>
        <tr>
            <th>Key</th>
            <th>Value</th>
        </tr>
        {% for key, value in case.data.items() %}
            {% if key != "observables" %}
                <tr>
                    <td> {{ key }} </td>
                    <td>{{ value }}</td>
                </tr>
            {% endif %}
        {% endfor %}
    </table>
</div>

{% block javascript %}
    <!--        Add custom styling for each artifact_# -->
    <script type="text/javascript">
        var colors = ['#1f618d', '#0074D9', '#7FDBFF', '#a9a70f', '#39CCCC', '#3D9970',
            '#2ECC40', '#01FF70', '#FF851B', '#FF4136', '#85144b', '#F012BE', '#B10DC9', '#17a589'];
        var color_pos = 0;

        // Get the element with class="artifact_varname", then get all members.
        var elements = document.getElementsByClassName('artifact_varname');
        console.log(elements)

        // Create a for loop and set the border of all <a> elements with a target attribute in div
        var i;
        for (i = 0; i < elements.length; i++) {
            console.log(elements[i])
            elements[i].style.color = colors[color_pos];
            if (color_pos === colors.length -1) {
              color_pos = 0
            } else {
              color_pos++;
            }
        }
    </script>

    <script type="text/javascript">
        var coll = document.getElementsByClassName("caseDetailsCollapsible");
        var i;

        for (i = 0; i < coll.length; i++) {
          coll[i].addEventListener("click", function() {
            this.classList.toggle("active");
            var content = this.nextElementSibling;
            if (content.style.display === "block") {
              content.style.display = "none";
            } else {
              content.style.display = "block";
            }
          });
        }
    </script>
{% endblock %}

{% set artifacts = case.data.observables %}
{% include 'yara_rule_designer.html' %}
